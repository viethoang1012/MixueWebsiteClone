<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="https://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
  <meta charset="UTF-8">
  <title>Chi tiết đơn hàng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>
<section layout:fragment="main-content">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <h1>Chi tiết đơn hàng #<span th:text="${order.id}"></span></h1>
        <hr>
        
        <!-- Thông tin đơn hàng -->
        <div class="card mb-4">
          <div class="card-header">
            <h5>Thông tin đơn hàng</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>Người nhận:</strong> <span th:text="${order.receiverName}"></span></p>
                <p><strong>Số điện thoại:</strong> <span th:text="${order.receiverPhone}"></span></p>
                <p><strong>Địa chỉ:</strong> <span th:text="${order.address}"></span></p>
                <p><strong>Ghi chú:</strong> <span th:text="${order.deliveryInstructions != null ? order.deliveryInstructions : 'Không có'}"></span></p>
              </div>
              <div class="col-md-6">
                <p><strong>Ngày đặt:</strong> <span th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></span></p>
                <p><strong>Tổng tiền:</strong> <span th:text="${order.totalPrice}"></span></p>
                <p>
                  <strong>Trạng thái:</strong> 
                  <span th:class="${order.status == 'Pending' ? 'badge bg-warning' : 
                                  (order.status == 'Processing' ? 'badge bg-info' : 
                                  (order.status == 'Completed' ? 'badge bg-success' : 
                                  (order.status == 'Cancelled' ? 'badge bg-danger' : 'badge bg-secondary')))}"
                        th:text="${order.status}"></span>
                </p>
                
                <!-- Form cập nhật trạng thái -->
                <form th:action="@{/orders/update-status}" method="post" class="mt-3">
                  <input type="hidden" name="id" th:value="${order.id}">
                  <div class="input-group">
                    <select name="status" class="form-select">
                      <option value="Pending" th:selected="${order.status == 'Pending'}">Đang chờ</option>
                      <option value="Processing" th:selected="${order.status == 'Processing'}">Đang xử lý</option>
                      <option value="Completed" th:selected="${order.status == 'Completed'}">Hoàn thành</option>
                      <option value="Cancelled" th:selected="${order.status == 'Cancelled'}">Đã hủy</option>
                    </select>
                    <button type="submit" class="btn btn-primary">Cập nhật</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Chi tiết sản phẩm -->
        <div class="card">
          <div class="card-header">
            <h5>Chi tiết sản phẩm</h5>
          </div>
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>ID Sản phẩm</th>
                  <th>Số lượng</th>
                  <th>Đơn giá</th>
                  <th>Thành tiền</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="item : ${orderItems}">
                  <td th:text="${item.productId}"></td>
                  <td th:text="${item.quantity}"></td>
                  <td th:text="${item.unitPrice}"></td>
                  <td th:text="${item.unitPrice.multiply(new java.math.BigDecimal(item.quantity))}"></td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="text-end"><strong>Tổng cộng:</strong></td>
                  <td><strong th:text="${order.totalPrice}"></strong></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        
        <!-- Nút quay lại -->
        <div class="mt-4">
          <a th:href="@{/orders/list-orders}" class="btn btn-secondary">
            <i class="fa-solid fa-arrow-left"></i> Quay lại danh sách
          </a>
        </div>
      </div>
    </div>
  </div>
</section>
</body>
</html>